Application Summary ‚Äì Multi-Fund Repo Trading & Cash Allocation Platform
Objective

A unified system that helps a bank or investment manager allocate and monitor daily fund cash across overnight repo trades, while ensuring:

No breach of pre-agreed liquidity limits with each counterparty.

Every fund‚Äôs cash account starts and ends the day flat (via integration with Eagle).

Full audit trail, regulatory transparency, and multi-fund visibility.

üß© Core Components
1. Fund

Each legal fund managed by the firm.

Holds attributes such as name, currency, and Eagle linkage.

All repo trades and cash accounts are fund-specific.

Column	Description
Id	Primary key
FundCode / FundName	Identifier and display name
CurrencyCode	Base currency
IsActive	Whether fund is trading
CreatedBy / ModifiedBy	Audit columns
2. RepoRate

Stores pre-agreed repo terms between the bank and its counterparties.

Includes TargetCircle, i.e., the maximum liquidity (in millions) the counterparty expects to borrow that day.

Used for compliance checking before trades are booked.

Column	Description
CounterpartyId	FK to Counterparty table
RepoDate	Effective date of rate
RepoRate	Agreed interest rate (e.g., 4.95%)
TargetCircle	Maximum total across all funds (in millions)
CreatedBy / ModifiedBy	Audit fields

Constraint:

When inserting trades, the system checks that Œ£(RepoTrades.Notional) for that Counterparty and Date ‚â§ TargetCircle √ó 1,000,000.

3. RepoTrades

Represents individual repo trades for each fund.

Key fields: FundId, CounterpartyId, Direction (Borrow/Lend), Notional, Rate, StartDate, EndDate, SettlementDate.

CHECK (Direction IN ('Borrow', 'Lend'))

RepoRateId FK to ensure trade rate references valid repo rate record.

Audit trail: CreatedBy, ModifiedBy, timestamps.

4. Cashflow

Logs actual cash movements (inflows/outflows) generated by repo settlements and maturities.

Every record linked to both FundId and CashAccountId.

5. CashAccount

Represents each fund‚Äôs cash account used for repo funding and settlements.

Linked 1-to-1 (or 1-to-many) with Fund.

6. Balances & Views

vAvailableCash: Real-time cash available per fund (starting cash + cashflows).

vFundBalances: Aggregated view of each fund‚Äôs available cash.

vCounterpartyExposure: Derived view showing total exposure vs TargetCircle.

7. Integration with Eagle

Inbound (morning): Eagle feed provides daily starting cash balances per fund.

Outbound (evening): System exports end-of-day flat cash balances for posting.

‚öôÔ∏è Key Business Rules

TargetCircle Enforcement

Before booking a repo trade, system validates:

SUM(Notional) for (Counterparty, Date) + NewTrade.Notional <= TargetCircle * 1,000,000


If exceeded ‚Üí reject or require override authorization.

Fund Flatness

End-of-day check ensures every fund‚Äôs cash account = 0.

System proposes adjustments (extra repo or short-term deposit) to rebalance.

Auditability

Every insert/update logged with CreatedBy/ModifiedBy.

Views expose trade and cashflow history for compliance.

üïì Day in the Life of the Repo Trading App
06:30 AM ‚Äì Eagle Feed Import

System receives starting cash per fund from Eagle:

Fund	Starting Cash	Currency
Fund A	¬£40m	GBP
Fund B	¬£25m	GBP
Fund C	¬£15m	GBP

These are stored in FundOpeningBalance or equivalent Cashflow with Source = Eagle.

07:00 AM ‚Äì RepoRate Load

System loads the day‚Äôs RepoRate table (via pre-agreed schedules):

Counterparty	RepoRate	TargetCircle (m)	RepoDate
Barclays	4.95%	60	19-Oct-2025
HSBC	4.90%	50	19-Oct-2025
UBS	4.92%	40	19-Oct-2025

This means:

Across all funds, trades against Barclays cannot exceed ¬£60m.

Against HSBC, ¬£50m, etc.

08:00 AM ‚Äì Trader Allocation

Repo desk reviews available cash and decides how to allocate across funds and counterparties.

Fund	Direction	Counterparty	Notional	Rate	StartDate	EndDate
Fund A	Lend	Barclays	¬£30m	4.95%	19-Oct	20-Oct
Fund B	Lend	Barclays	¬£20m	4.95%	19-Oct	20-Oct
Fund C	Lend	Barclays	¬£10m	4.95%	19-Oct	20-Oct

Before committing the last trade:

System checks total against Barclays:
¬£30m + ¬£20m + ¬£10m = ¬£60m, exactly the TargetCircle ‚Üí ‚úÖ allowed.

If someone tried ¬£15m more, system would block:

‚ùå ‚ÄúTrade exceeds Barclays‚Äô TargetCircle of ¬£60m for 19-Oct-2025.‚Äù

09:30 AM ‚Äì Trade Settlement

Once trades are booked, cashflows are created:

Outflow from each fund‚Äôs cash account to counterparty.

Collateral received (tracked for reporting but not in cash).

After settlement, available cash:

Fund	Start Cash	Repo Outflow	Remaining
Fund A	¬£40m	¬£30m	¬£10m
Fund B	¬£25m	¬£20m	¬£5m
Fund C	¬£15m	¬£10m	¬£5m
02:00 PM ‚Äì Adjustments

If new Eagle inflows/outflows occur or repo opportunities arise, traders can adjust.

System again enforces TargetCircle per counterparty.

It recalculates available balances via vAvailableCash.

05:30 PM ‚Äì Reconciliation

The app computes end-of-day balances per fund:

If any cash remains positive ‚Üí propose new repo.

If negative ‚Üí borrow via reverse repo.

Goal: Each fund‚Äôs end-of-day balance = ¬£0.

06:00 PM ‚Äì Eagle Posting

System exports closing entries:

Fund	Ending Cash	Action
Fund A	¬£0	Posted to Eagle
Fund B	¬£0	Posted to Eagle
Fund C	¬£0	Posted to Eagle

Funds are now flat.

Traders leave desks knowing:

Counterparty limits respected.

All trades reconciled and auditable.

Next Morning (T+1)

Trades mature ‚Üí inflows booked (principal + interest).

Eagle provides new starting cash again.

Cycle repeats.

üîç Example Validation Logic (in SQL)
-- Check before booking new repo
DECLARE @CounterpartyId INT = 1, @RepoDate DATE = '2025-10-19', @NewNotional DECIMAL(18,2) = 15000000;

IF (
    SELECT SUM(rt.Notional)
    FROM dbo.RepoTrades rt
    JOIN dbo.RepoRate rr ON rt.RepoRateId = rr.Id
    WHERE rt.CounterpartyId = @CounterpartyId AND rt.StartDate = @RepoDate
) + @NewNotional >
(
    SELECT TargetCircle * 1000000 FROM dbo.RepoRate WHERE CounterpartyId = @CounterpartyId AND RepoDate = @RepoDate
)
BEGIN
    THROW 51000, 'Trade exceeds TargetCircle for this counterparty.', 1;
END;

üí° Key Benefits
Area	Benefit
Liquidity Control	Prevents exceeding pre-agreed limits (TargetCircle).
Transparency	Real-time visibility of fund-level and counterparty-level positions.
Audit Readiness	Full traceability of who booked, modified, or approved each trade.
Operational Efficiency	Automatic Eagle integration keeps daily cycle seamless.
Risk Management	Centralized exposure view per fund and counterparty.

Would you like me to include a Mermaid architecture diagram next ‚Äî showing how Eagle, RepoRates, Funds, Trades, Cashflows, and Users interact end-to-end across a trading day?